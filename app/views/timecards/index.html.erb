<%# /timecards 上長・管理者用メンバー一覧ページ %>

<% if current_user.user_type == "上長" %>
  <% @users = @users.where(approver_id: current_user.id) %>
<% end %>

<%= render "shared/flash" %>
<%= render "shared/header_common" %>

<div class="timecards-wrapper">

  <h2><i class="fas fa-user-friends"></i> メンバー</h2>

  <% if current_user.user_type == "上長" %>
    <% @users = @users.where(approver_id: current_user.id) %>

    <% @users.each do |m| %>

      <div class="timecards-user">
        <span><%= m.full_name %></span>
        <%= link_to "/user/#{m.id}/year_month/#{Day.find_by(date: Date.today).year_month_id}" do %>
          <i class="far fa-calendar-alt"></i>
          <% if m.timecard_error %>
            <i class="fas fa-exclamation-triangle"></i>
          <% end %>
        <% end %>
        <%= link_to "/travel_cost/index/#{m.id}/#{Day.find_by(date: Date.today).year_month_id}" do %>
          <i class="fas fa-yen-sign"></i>
          <% if m.travel_cost_error %>
            <i class="fas fa-exclamation-triangle"></i>
          <% end %>
        <% end %>
      </div>

    <% end %>

  <% elsif current_user.user_type == "管理者" %>
    <div class="timecards-department">
      <h3>■営業部</h3>
      <% @users.where(department: "営業部").each do |m| %>

        <div class="timecards-user">
          <span><%= m.full_name %></span>
          <%= link_to "/user/#{m.id}/year_month/#{Day.find_by(date: Date.today).year_month_id}" do %>
            <i class="far fa-calendar-alt"></i>
            <% if m.timecard_error %>
              <i class="fas fa-exclamation-triangle"></i>
            <% end %>
          <% end %>
          <%= link_to "/travel_cost/index/#{m.id}/#{Day.find_by(date: Date.today).year_month_id}" do %>
            <i class="fas fa-yen-sign"></i>
            <% if m.travel_cost_error %>
              <i class="fas fa-exclamation-triangle"></i>
            <% end %>
          <% end %>
        </div>

      <% end %>
    </div>

    <div class="timecards-department">
      <h3>■貿易部</h3>
      <% @users.where(department: "貿易部").each do |m| %>

        <div class="timecards-user">
          <span><%= m.full_name %></span>
          <%= link_to "/user/#{m.id}/year_month/#{Day.find_by(date: Date.today).year_month_id}" do %>
            <i class="far fa-calendar-alt"></i>
            <% if m.timecard_error %>
              <i class="fas fa-exclamation-triangle"></i>
            <% end %>
          <% end %>
          <%= link_to "/travel_cost/index/#{m.id}/#{Day.find_by(date: Date.today).year_month_id}" do %>
            <i class="fas fa-yen-sign"></i>
            <% if m.travel_cost_error %>
              <i class="fas fa-exclamation-triangle"></i>
            <% end %>
          <% end %>
        </div>

      <% end %>
    </div>

    <div class="timecards-department">
      <h3>■システム部</h3>
      <% @users.where(department: "システム部").each do |m| %>

        <div class="timecards-user">
          <span><%= m.full_name %></span>
          <%= link_to "/user/#{m.id}/year_month/#{Day.find_by(date: Date.today).year_month_id}" do %>
            <i class="far fa-calendar-alt"></i>
            <% if m.timecard_error %>
              <i class="fas fa-exclamation-triangle"></i>
            <% end %>
          <% end %>
          <%= link_to "/travel_cost/index/#{m.id}/#{Day.find_by(date: Date.today).year_month_id}" do %>
            <i class="fas fa-yen-sign"></i>
            <% if m.travel_cost_error %>
              <i class="fas fa-exclamation-triangle"></i>
            <% end %>
          <% end %>
        </div>
        
      <% end %>
    </div>

    <div class="timecards-department">
      <h3>■その他</h3>
      <% @users.where(department: "その他").each do |m| %>
      
        <div class="timecards-user">
          <span><%= m.full_name %></span>
          <%= link_to "/user/#{m.id}/year_month/#{Day.find_by(date: Date.today).year_month_id}" do %>
            <i class="far fa-calendar-alt"></i>
            <% if m.timecard_error %>
              <i class="fas fa-exclamation-triangle"></i>
            <% end %>
          <% end %>
          <%= link_to "/travel_cost/index/#{m.id}/#{Day.find_by(date: Date.today).year_month_id}" do %>
            <i class="fas fa-yen-sign"></i>
            <% if m.travel_cost_error %>
              <i class="fas fa-exclamation-triangle"></i>
            <% end %>
          <% end %>
        </div>

      <% end %>
    </div>
  <% end %>
</div>
